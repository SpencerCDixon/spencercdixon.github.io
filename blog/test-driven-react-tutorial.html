<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Spencer Dixon - Test Driven React Tutorial</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/blog/feed.xml" />
    <link href="../stylesheets/all.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div class="wrapper">
      <aside>
        <nav class="main-nav">
<a href="../">    <img class="round-image" src="../images/spencer.jpeg" />
</a>
  <ul class="nav-links">
    <li class="text-center"><a href="../about.html">ABOUT</a></li>
    <li class="text-center"><a href="../">BLOG</a></li>
    <li class="text-center"><a href="../book_list.html">BOOKS</a></li>
  </ul>

  <!-- Begin MailChimp Signup Form -->
  <div id="mc_embed_signup">
    <form action="//spencerdixon.us11.list-manage.com/subscribe/post?u=019dc2164dbdc16d844cf6dc2&amp;id=666e212a4d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">

        <div class="mc-field-group">
          <label for="mce-EMAIL" style="display: none;">Email Address </label>
          <input type="email" placeholder="Email To Subscribe" name="EMAIL" class="required email" id="mce-EMAIL">
        </div>
        <div id="mce-responses" class="clear">
          <div class="response" id="mce-error-response" style="display:none"></div>
          <div class="response" id="mce-success-response" style="display:none"></div>
        </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;"><input type="text" name="b_019dc2164dbdc16d844cf6dc2_666e212a4d" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" style="display: none;" class="button"></div>
      </div>
    </form>
  </div>
  <!--End mc_embed_signup-->

  <section class="social-media">
    <ul>
      <li class="social-icon">
<a target="_blank" href="https://github.com/spencercdixon">          <i class="fa fa-github-square fa-2x"></i>
</a>      </li>
      <li class="social-icon">
<a target="_blank" href="https://twitter.com/SpencerCDixon">          <i class="fa fa-twitter-square fa-2x"></i>
</a>      </li>
      <li class="social-icon">
<a target="_blank" href="https://www.linkedin.com/in/spencercdixon">          <i class="fa fa-linkedin-square fa-2x"></i>
</a>      </li>
    </ul>
  </section>
</nav>

<footer>
  Handcrafted Bytes<br />
  Made With <i class="fa fa-diamond"></i> <br />
  By Spencer Dixon
</footer>


      </aside>

      <article class="blog-post">
            <h1 id="article-title">Test Driven React Tutorial</h1>
    <hr>
    <div class="tags">
      <ul>
        <li class="tag"><a href="tags/tutorial.html">tutorial</a></li>
        <li class="tag"><a href="tags/testing.html">testing</a></li>
        <li class="tag"><a href="tags/react.html">react</a></li>
        <li class="tag"><a href="tags/javascript.html">javascript</a></li>
      </ul>
    </div>

  <p>Testing is an important part of the development cycle.  There is a name for code
without tests: legacy code.  When I first started learning React and JavaScript
it was overwhelming to say the least.  If you&#39;re new to the JS/React community you&#39;re 
probably feeling super overwhelmed as well.  Thinking things like: </p>

<ul>
<li>Which build tool should I use?</li>
<li>Which testing framework is right?<br></li>
<li>What flux pattern should I be learning?<br></li>
<li>Do I even need to use flux?</li>
</ul>

<p>That&#39;s why I decided to write this post.  After hours of reading blog posts,
looking through source code of respected JS developers, and one JSConf in
Florida, I&#39;ve finally found my testing &#39;groove&#39;.  In the beginning I felt so naked and dirty for
programming React code without tests.  I want to live in a world where no
developer ever needs to feel that way.  It&#39;s just not right.  </p>

<p>All the code for this tutorial is available on my <a href="https://github.com/SpencerCDixon/react-testing-starter-kit">github located here.</a></p>

<p>Let&#39;s get started!</p>

<h2>Setting Up Webpack</h2>

<p>This isn&#39;t a tutorial on how to use webpack so I won&#39;t go into great detail but
it&#39;s important to understand the basics.  Webpack is like the Rails Asset
pipeline on crack.  On a basic level it lets you pre/post process all your code
and serve just one <code>bundle.js</code> to the client which will run your react app.</p>

<p>It&#39;s an extremely powerful tool which is why we&#39;ll be using it.  Webpack is one
of those tools that scares the shit out of you at first, which I recommend you
embrace, but once you start understanding how it works you feel like a God.  Stick
with it and give it a chance before you judge.  </p>

<p>We often don&#39;t like things we&#39;re not good at or scared of.  However, once you overcome the initial discomfort and
start understanding something it almost always becomes fun.  In fact, that&#39;s
exactly how I felt about testing in general.  Hated it when I sucked at it, love
it now that I don&#39;t suck at it :-) </p>

<p>Here are some more resources to learn more about webpack if interested:</p>

<ol>
<li> <a href="https://christianalfoni.github.io/react-webpack-cookbook/Getting-started.html">Webpack Cookbook</a> (uses Babel 5 but still useful resource for learning webpack fundamentals)</li>
<li> <a href="http://blog.madewithlove.be/post/webpack-your-bags/">Webpack Beginner Blog Post</a><br></li>
<li> <a href="https://github.com/petehunt/webpack-howto">Pete Hunts Infamous Webpack How-to</a><br></li>
</ol>

<blockquote>
<p><strong>NOTE</strong>: I recommend using node <code>v5.1.0</code> if you&#39;re going to follow along with
this tutorial.  Anything <code>&gt;4</code> should be fine though.</p>
</blockquote>

<p>First, lets install all webpack and babel dependencies.  Babel is a JavaScript
transpiler which allows us to write ES6 (es2015) and ES7 code and make sure it all gets
compiled down to ES5 which the browser can use.  </p>
<pre class="highlight plaintext"><code>mkdir tdd_react
cd tdd_react
npm init        # follow along with normal npm init to set up project

npm i babel-loader babel-core webpack --save-dev
</code></pre>

<blockquote>
<p><code>npm i</code> is an alias for npm install.  </p>
</blockquote>

<p>Next lets set up our project directory and create a <code>webpack.config.js</code> file:</p>
<pre class="highlight plaintext"><code>mkdir src                  # where all our source code will live
touch src/main.js          # this will be the entry point for our webpack bundling
mkdir test                 # place to store all our tests
mkdir dist                 # this is where the bundled javascript from webpack will go
touch webpack.config.js    # our webpack configuration file
</code></pre>

<p>Our initial webpack config will be super minimal.  Read through comments to
understand what&#39;s going on:  </p>
<pre class="highlight javascript"><code><span class="c1">// our webpack.config.js file located in project root</span>

<span class="kd">var</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'webpack'</span><span class="p">);</span> 
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>                <span class="c1">// a useful node path helper library</span>

<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="p">[</span><span class="s1">'./src/main.js'</span><span class="p">],</span>                <span class="c1">// the entry point for our app</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'dist'</span><span class="p">),</span> <span class="c1">// store the bundled output in dist/bundle.js</span>
    <span class="na">filename</span><span class="p">:</span> <span class="s1">'bundle.js'</span>                  <span class="c1">// specifying file name for our compiled assets</span>
  <span class="p">},</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span>
      <span class="c1">// telling webpack which loaders we want to use.  For now just run the</span>
      <span class="c1">// code through the babel-loader.  'babel' is an alias for babel-loader</span>
      <span class="p">{</span> <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">,</span> <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span><span class="s1">'babel'</span><span class="p">],</span> <span class="na">exclude</span><span class="p">:</span> <span class="sr">/node_modules/</span> <span class="p">}</span>   
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
</code></pre>

<p>In order for babel to do its job properly we need to tell it which <code>presets</code> we
want to use.  Let&#39;s go ahead and install the React and ES6 presets since we&#39;re
going to need those:</p>
<pre class="highlight plaintext"><code>npm i babel-preset-react babel-preset-es2015 --save-dev
</code></pre>

<p>Now we have a couple options.  Some people will tell babel to use the presets in
the loader directly in the webpack config file like this:  </p>
<pre class="highlight javascript"><code><span class="nx">loaders</span><span class="err">:</span> <span class="p">[</span>
  <span class="p">{</span> 
    <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">,</span> 
    <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span><span class="s1">'babel'</span><span class="p">],</span> 
    <span class="na">exclude</span><span class="p">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
    <span class="na">query</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">presets</span><span class="p">:</span> <span class="p">[</span><span class="s1">'react'</span><span class="p">,</span> <span class="s1">'es2015'</span><span class="p">]</span> 
    <span class="p">}</span>
  <span class="p">}</span>   
<span class="p">]</span>
</code></pre>

<p>Another approach is to store them in a <code>.babelrc</code> which is what I&#39;m going to do
for this project.  By storing our babel presets in the <code>.babelrc</code> it makes it
easier for future developers to find what kind of babel presets are enabled.
Additionally, when we set up Karma to use webpack later in the tutorial we won&#39;t need to 
do any preset configuration since it will already be present in the <code>.babelrc</code> file.</p>
<pre class="highlight plaintext"><code># inside our project root
touch .babelrc
</code></pre>

<p>Paste in the presets:  </p>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="p">.</span><span class="nx">babelrc</span>
<span class="p">{</span>
  <span class="s2">"presets"</span><span class="err">:</span> <span class="p">[</span><span class="s2">"react"</span><span class="p">,</span> <span class="s2">"es2015"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>NOTE: due to the nature of how quickly npm packages get upgraded in the
React/JS community.  If at any point in the tutorial you&#39;re getting errors try
installing exact package versions using the package-name@version-number-here
syntax.  The completed package.json can be found at the end of the tutorial for
reference</p>
</blockquote>

<p>To confirm it works lets put some react code in <code>main.js</code> and see if it bundles
everything properly.  Install React and React DOM:  </p>
<pre class="highlight javascript"><code><span class="nx">npm</span> <span class="nx">i</span> <span class="nx">react</span> <span class="nx">react</span><span class="o">-</span><span class="nx">dom</span> <span class="o">-</span><span class="nx">S</span>
</code></pre>

<blockquote>
<p>Using the <code>-S</code> flag is an alias for <code>--save</code>.  </p>
</blockquote>

<p>Create the first React component:  </p>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="nx">src</span><span class="o">/</span><span class="nx">main</span><span class="p">.</span><span class="nx">js</span>
<span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">render</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-dom'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Root</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span> <span class="nx">Hello</span> <span class="nx">World</span> <span class="o">&lt;</span><span class="sr">/h1&gt;</span><span class="err">;
</span>  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Root</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">));</span>
</code></pre>

<p>The astute reader will have noticed we have not yet created an <code>index.html</code> file
with our root.  Lets do that next and put it in our <code>/dist</code> folder since that is
where our <code>bundle.js</code> will get compiled to:  </p>
<pre class="highlight html"><code># /dist/index.html

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"root"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>

<p>Awesome.  Making progress.  Finally we can run webpack and see if everything
worked properly.  If you don&#39;t have webpack installed globally (<code>npm i webpack
-g</code>) then you can run it from your node modules like so:  </p>
<pre class="highlight javascript"><code><span class="p">.</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="p">.</span><span class="nx">bin</span><span class="o">/</span><span class="nx">webpack</span>
</code></pre>

<p>Webpack will by default look for a config with the name <code>webpack.config.js</code>.
You could also pass in a different webpack config as an argument if you so
pleased.  </p>

<p>Let&#39;s create an alias for doing the build inside our package.json:  </p>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="kr">package</span><span class="p">.</span><span class="nx">json</span>
<span class="p">...</span> <span class="nx">other</span> <span class="nx">stuff</span>
<span class="s2">"scripts"</span><span class="err">:</span> <span class="p">{</span>
  <span class="s2">"build"</span><span class="err">:</span> <span class="s2">"webpack"</span>
<span class="p">}</span>
</code></pre>

<p>Next lets wire up <code>webpack-dev-server</code> for a more enjoyable dev experience:  </p>
<pre class="highlight javascript"><code><span class="nx">npm</span> <span class="nx">i</span> <span class="nx">webpack</span><span class="o">-</span><span class="nx">dev</span><span class="o">-</span><span class="nx">server</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span>
</code></pre>

<p>Add webpack dev server entry points to our <code>webpack.config.js</code>  </p>
<pre class="highlight javascript"><code><span class="p">...</span> <span class="nx">rest</span> <span class="nx">of</span> <span class="nx">config</span>
  <span class="nl">entry</span><span class="p">:</span> <span class="p">[</span>
    <span class="s1">'webpack/hot/dev-server'</span><span class="p">,</span>
    <span class="s1">'webpack-dev-server/client?http://localhost:3000'</span><span class="p">,</span>
    <span class="s1">'./src/main.js'</span>
  <span class="p">],</span>
<span class="p">...</span> <span class="nx">rest</span> <span class="nx">of</span> <span class="nx">config</span>
</code></pre>

<p>Make script for running the dev server:  </p>
<pre class="highlight plaintext"><code># package.json
... other stuff
scripts: {
  "dev": "webpack-dev-server --port 3000 --devtool eval --progress --colors --hot --content-base dist",
  "build": "webpack"
}
</code></pre>

<p>The script uses the <code>--content-base</code> flag to tell webpack we want to serve our
<code>/dist</code> folder.  We&#39;re also explicitly using port 3000 to provide a more
familiar Rails experience.</p>

<p>Finally, lets add a resolve flag to webpack to make importing files a little
more intuitive.  Here is the final config with comments, read through them:  </p>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'webpack'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="p">[</span>
    <span class="s1">'webpack/hot/dev-server'</span><span class="p">,</span>
    <span class="s1">'webpack-dev-server/client?http://localhost:3000'</span><span class="p">,</span>
    <span class="s1">'./src/main.js'</span>
  <span class="p">],</span>
  <span class="na">resolve</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">root</span><span class="p">:</span> <span class="p">[</span>
      <span class="c1">// allows us to import modules as if /src was the root.</span>
      <span class="c1">// so I can do: import Comment from 'components/Comment'</span>
      <span class="c1">// instead of:  import Comment from '../components/Comment' or whatever relative path would be</span>
      <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'./src'</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="c1">// allows you to require without the .js at end of filenames</span>
    <span class="c1">// import Component from 'component' vs. import Component from 'component.js'</span>
    <span class="na">extensions</span><span class="p">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'.js'</span><span class="p">,</span> <span class="s1">'.json'</span><span class="p">,</span> <span class="s1">'.jsx'</span><span class="p">]</span>
  <span class="p">},</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'dist'</span><span class="p">),</span>
    <span class="na">filename</span><span class="p">:</span> <span class="s1">'bundle.js'</span>
  <span class="p">},</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">js</span><span class="se">?</span><span class="sr">$/</span><span class="p">,</span>
        <span class="c1">// dont run node_modules or bower_components through babel loader</span>
        <span class="na">exclude</span><span class="p">:</span> <span class="sr">/</span><span class="se">(</span><span class="sr">node_modules|bower_components</span><span class="se">)</span><span class="sr">/</span><span class="p">,</span>
        <span class="c1">// babel is alias for babel-loader</span>
        <span class="c1">// npm i babel-core babel-loader --save-dev</span>
        <span class="na">loader</span><span class="p">:</span> <span class="s1">'babel'</span>
      <span class="p">}</span>
    <span class="p">],</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
</code></pre>

<p>To confirm everything works lets go ahead and run the dev server and confirm we
see &#39;Hello World&#39; on the screen.</p>
<pre class="highlight plaintext"><code>npm run dev
open http://localhost:3000
</code></pre>

<p>You should see something that looks like this:  </p>

<p><img alt="Hello World Image" src="http://i.imgur.com/rYTjH77.png?1" /></p>

<h2>Setting Up Mocha, Chai, Sinon, and Enzyme</h2>

<p><strong>Mocha</strong>: will be used for running our tests.<br>
<strong>Chai</strong>: will be used as our expectation library.  Very versatile and lets us
use RSpec like syntax.<br>
<strong>Sinon</strong>: will be used for mocks/stubs/spys.<br>
<strong>Enzyme</strong>: will be used for testing our React components.  It&#39;s a beautiful
testing library written by AirBnB.  </p>

<p>Install packages:  </p>
<pre class="highlight plaintext"><code>npm i mocha chai sinon --save-dev
</code></pre>

<p>If we want to be able to write tests in ES6 we will need to compile the tests
before running.  To do that we can use babel-register:  </p>
<pre class="highlight plaintext"><code>npm i babel-register --save-dev
</code></pre>

<p>Let&#39;s add some npm scripts in <code>package.json</code> to make testing life easier:</p>
<pre class="highlight plaintext"><code># ./package.json 
... rest of package.json
  "scripts": {
    "test": "mocha --compilers js:babel-register --recursive",
    "test:watch": "npm test -- --watch",
    "build": "webpack",
    "dev": "webpack-dev-server --port 3000 --devtool eval --progress --colors --hot --content-base dist",
  },

</code></pre>

<p>Our test script says to run mocha using the <code>babel-register</code> compiler and look
recursively through our <code>/test</code> directory.</p>

<p>Eventually we&#39;re going to set up Karma so these npm scripts will be useless but
if Karma isn&#39;t your thing then those should work fine.  <code>npm run test:watch</code> will watch
for file changes and re-run your suite.  Hooray productivity!</p>

<p>To confirm it works lets create a hello world test in <code>/tests/helloWorld.spec.js</code>  </p>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="o">/</span><span class="nx">test</span><span class="o">/</span><span class="nx">helloWorld</span><span class="p">.</span><span class="nx">spec</span><span class="p">.</span><span class="nx">js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">expect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'chai'</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s1">'works!'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="kc">true</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>

<p>Pretty chill... almost looks like RSpec!</p>

<p>Importing <code>expect</code> for every test is kind of a bummer though so lets create a
<code>test_helper</code> file to save keystrokes.  </p>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="o">/</span><span class="nx">test</span><span class="o">/</span><span class="nx">test_helper</span><span class="p">.</span><span class="nx">js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">expect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'chai'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">sinon</span> <span class="nx">from</span> <span class="s1">'sinon'</span><span class="p">;</span>

<span class="nx">global</span><span class="p">.</span><span class="nx">expect</span> <span class="o">=</span> <span class="nx">expect</span><span class="p">;</span>
<span class="nx">global</span><span class="p">.</span><span class="nx">sinon</span> <span class="o">=</span> <span class="nx">sinon</span><span class="p">;</span>
</code></pre>

<p>Then include it in the npm script that runs the suite via the <code>--require ./test/test_helper.js</code> statement:  </p>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="kr">package</span><span class="p">.</span><span class="nx">json</span> <span class="nx">script</span> <span class="nx">section</span>
  <span class="s2">"test"</span><span class="err">:</span> <span class="s2">"mocha --compilers js:babel-register --require ./test/test_helper.js --recursive"</span><span class="p">,</span>
</code></pre>

<p>I also added sinon so it would be available globally.  Now whenever we write new
tests <code>expect</code> and <code>sinon</code> will be available to use and we won&#39;t need to import
them manually.</p>

<h3>Enzyme</h3>

<p>Now that our more &#39;universal&#39; testing tools are set up (mocha, chai, sinon)
let&#39;s install Enzyme and start testing some React components!</p>

<p>Install packages:</p>

<blockquote>
<p><strong>Note</strong> it&#39;s important to install version 1.2.0 of enzyme since in 2.0 
there are some breaking changes that affect the tutorial</p>
</blockquote>
<pre class="highlight plaintext"><code>npm i enzyme@1.2.0 react-addons-test-utils --save-dev
</code></pre>

<p>Enzyme has great documentation which can be <a href="http://airbnb.io/enzyme/">found here</a>.  I recommend reading
through the Shallow Rendering section when you have the time.</p>

<blockquote>
<p><em>What is Shallow Rendering you ask?</em>  </p>
</blockquote>

<p>Well, it&#39;s a way for us to call the <code>render</code> method of our components and get
back React elements which we can make assertions on without having to actually
mount our component to the DOM.  For more on React Elements <a href="https://facebook.github.io/react/blog/2015/12/18/react-components-elements-and-instances.html">see here</a>.</p>

<p>Enzyme will wrap the shallow rendered component in a special <code>wrapper</code> which we
can then test.  Think of it like the <code>page</code> object in Capybara if you come from
Rails.</p>

<p>Lets do some TDD to drive the development of a proper <code>&lt;Root /&gt;</code> component.</p>

<p>This Root component will be a <code>container</code> meaning that it will be in charge of
handling the state of our application.  Learning the difference between smart
and dumb components in React is very important for good application
architecture.  <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.8cnl19w8l">Here is a great blog post explaining what they are.</a></p>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="o">/</span><span class="nx">tests</span><span class="o">/</span><span class="nx">containers</span><span class="o">/</span><span class="nx">Root</span><span class="p">.</span><span class="nx">spec</span><span class="p">.</span><span class="nx">js</span>

<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>                     <span class="c1">// required to get test to work.  we can get around this later with more configuration</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">shallow</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'enzyme'</span><span class="p">;</span>              <span class="c1">// method from enzyme which allows us to do shallow render</span>
<span class="kr">import</span> <span class="nx">Root</span> <span class="nx">from</span> <span class="s1">'../../src/containers/Root'</span><span class="p">;</span>  <span class="c1">// import our soon to be component</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'(Container) Root'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s1">'renders as a &lt;div&gt;'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">shallow</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Root</span> <span class="o">/&gt;</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">type</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'div'</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'has style with height 100%'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">shallow</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Root</span> <span class="o">/&gt;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">expectedStyles</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">height</span><span class="p">:</span> <span class="s1">'100%'</span><span class="p">,</span>
      <span class="na">background</span><span class="p">:</span> <span class="s1">'#333'</span>
    <span class="p">}</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="s1">'style'</span><span class="p">)).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="nx">expectedStyles</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'contains a header explaining the app'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">shallow</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Root</span> <span class="o">/&gt;</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.welcome-header'</span><span class="p">)).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">length</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>

<p>If we run the tests with <code>npm test</code> they should fail.  It makes sense since we
havn&#39;t actually created a Root component in the proper location.  So lets do
that:  </p>

<blockquote>
<p>If at any point you want to see the source for this code it is all available 
<a href="https://github.com/SpencerCDixon/react-testing-starter-kit">on github here</a></p>
</blockquote>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">containers</span><span class="o">/</span><span class="nx">Root</span><span class="p">.</span><span class="nx">js</span>
<span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">styles</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">height</span><span class="p">:</span> <span class="s1">'100%'</span><span class="p">,</span>
  <span class="na">background</span><span class="p">:</span> <span class="s1">'#333'</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Root</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'welcome-header'</span><span class="o">&gt;</span><span class="nx">Welcome</span> <span class="nx">to</span> <span class="nx">testing</span> <span class="nx">React</span><span class="o">!&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Root</span><span class="p">;</span>
</code></pre>

<p>If you re-run the tests they should all pass now.  </p>

<p>There was a lot of duplication in our tests so lets go back and do some
refactoring.  Since we&#39;re never passing any props to the <code>Root</code>, we can just
shallow render it once and then make all our assertions off that one wrapper.  Often times I find myself
wrapping a section of tests in &#39;sub&#39; describe blocks that pass in a certain set of
props and then make a bunch of assertions given those props.  Similar to using
&#39;context&#39; blocks if you&#39;ve used RSpec.  </p>
<pre class="highlight javascript"><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'(Container) Root'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">shallow</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Root</span> <span class="o">/&gt;</span><span class="p">);</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'renders as a &lt;div&gt;'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">type</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'div'</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'has style with height 100%'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">expectedStyles</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">height</span><span class="p">:</span> <span class="s1">'100%'</span><span class="p">,</span>
      <span class="na">background</span><span class="p">:</span> <span class="s1">'#333'</span>
    <span class="p">}</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="s1">'style'</span><span class="p">)).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="nx">expectedStyles</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'contains a header explaining the app'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.welcome-header'</span><span class="p">)).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">length</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>

<p>Stick to using <code>shallow</code> as
much as you possibly can in your tests.  Occasionally it&#39;s not possible
though.  For example, if you need to test the React lifecycle methods then you
need the component to actually mount.  </p>

<p>Next lets test a component mounting and calling a function when it mounts so we can
get some exposure to <code>sinon</code> and using spys.</p>

<p>We can pretend that the <code>Root</code> component has a child called <code>CommentList</code> which
will call some arbitrary callback when it mounts.  The function it calls when it
mounts will be given via props so we can practice testing that scenario.  Let&#39;s also
conditionally render some styles on the comment list so we can see how to deal
with styling in shallow renders.  <code>CommentList</code> will go in a components folder
located at <code>/src/components/CommentList.js</code>.  Since it won&#39;t be in charge of handling data 
, thus working entirely off of props, the component will be a <em>pure</em> (aka <em>dumb</em>) component:</p>
<pre class="highlight javascript"><code><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>

<span class="c1">// Once we set up Karma to run our tests through webpack</span>
<span class="c1">// we will no longer need to have these long relative paths</span>
<span class="kr">import</span> <span class="nx">CommentList</span> <span class="nx">from</span> <span class="s1">'../../src/components/CommentList'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span>
  <span class="nx">describeWithDOM</span><span class="p">,</span>
  <span class="nx">mount</span><span class="p">,</span>
  <span class="nx">shallow</span><span class="p">,</span>
  <span class="nx">spyLifecycle</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">'enzyme'</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'(Component) CommentList'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// using special describeWithDOM helper that enzyme</span>
  <span class="c1">// provides so if other devs on my team don't have JSDom set up</span>
  <span class="c1">// properly or are using old version of node it won't bork their test suite</span>
  <span class="c1">//</span>
  <span class="c1">// All of our tests that depend on mounting should go inside one of these</span>
  <span class="c1">// special describe blocks</span>
  <span class="nx">describeWithDOM</span><span class="p">(</span><span class="s1">'Lifecycle methods'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="s1">'calls componentDidMount'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">spyLifecyle</span><span class="p">(</span><span class="nx">CommentList</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">onMount</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>  <span class="c1">// an anonymous function in ES6 arrow syntax</span>
        <span class="na">isActive</span><span class="p">:</span> <span class="kc">false</span>
      <span class="p">}</span>

      <span class="c1">// using destructuring to pass props down</span>
      <span class="c1">// easily and then mounting the component</span>
      <span class="nx">mount</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">CommentList</span> <span class="p">{...</span><span class="nx">props</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="se">)</span><span class="err">;
</span>
      <span class="c1">// CommentList's componentDidMount should have been</span>
      <span class="c1">// called once.  spyLifecyle attaches sinon spys so we can</span>
      <span class="c1">// make this assertion</span>
      <span class="nx">expect</span><span class="p">(</span>
        <span class="nx">CommentList</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">componentDidMount</span><span class="p">.</span><span class="nx">calledOnce</span>
      <span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="kc">true</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">'calls onMount prop once it mounts'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// create a spy for the onMount function</span>
      <span class="kr">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="p">{</span> <span class="na">onMount</span><span class="p">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">spy</span><span class="p">()</span> <span class="p">};</span>

      <span class="c1">// mount our component</span>
      <span class="nx">mount</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">CommentList</span> <span class="p">{...</span><span class="nx">props</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="se">)</span><span class="err">;
</span>
      <span class="c1">// expect that onMount was called</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">onMount</span><span class="p">.</span><span class="nx">calledOnce</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="kc">true</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>

<p>There is a lot going on there.  Read through the comments to get a better
understanding.  Look at the implementation that makes the tests pass then go back
and look at the tests again to confirm you understand.</p>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">components</span><span class="o">/</span><span class="nx">CommentList</span><span class="p">.</span><span class="nx">js</span>
<span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">PropTypes</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">propTypes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">onMount</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
  <span class="na">isActive</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">bool</span>
<span class="p">};</span>

<span class="kr">class</span> <span class="nx">CommentList</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onMount</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span> <span class="nx">Comment</span> <span class="nx">One</span> <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">CommentList</span><span class="p">.</span><span class="nx">propTypes</span> <span class="o">=</span> <span class="nx">propTypes</span><span class="p">;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">CommentList</span><span class="p">;</span>
</code></pre>

<p>Run <code>npm test</code> and the suite should now pass.  </p>

<p>Next lets add some shallow rendered tests to make sure
our component is applying the proper CSS classes given its <code>isActive</code> prop.</p>
<pre class="highlight javascript"><code><span class="p">...</span> <span class="nx">previous</span> <span class="nx">tests</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'should render as a &lt;ul&gt;'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="p">{</span> <span class="na">onMount</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{}</span> <span class="p">};</span>
    <span class="kr">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">shallow</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">CommentList</span>  <span class="p">{...</span><span class="nx">props</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="se">)</span><span class="err">;
</span>    <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">type</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'ul'</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">describe</span><span class="p">(</span><span class="s1">'when active...'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">shallow</span><span class="p">(</span>
      <span class="c1">// just passing isActive is an alias for true</span>
      <span class="o">&lt;</span><span class="nx">CommentList</span> <span class="nx">onMount</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">{}}</span> <span class="nx">isActive</span> <span class="o">/&gt;</span>
    <span class="p">)</span>
    <span class="nx">it</span><span class="p">(</span><span class="s1">'should render with className active-list'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="s1">'className'</span><span class="p">)).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'active-list'</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">describe</span><span class="p">(</span><span class="s1">'when inactive...'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">shallow</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">CommentList</span> <span class="nx">onMount</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">{}}</span> <span class="nx">isActive</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="p">)</span>
    <span class="nx">it</span><span class="p">(</span><span class="s1">'should render with className inactive-list'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="s1">'className'</span><span class="p">)).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'inactive-list'</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>

<p>To make them pass:</p>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">CommentList</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onMount</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">isActive</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">className</span> <span class="o">=</span> <span class="nx">isActive</span> <span class="p">?</span> <span class="s1">'active-list'</span> <span class="p">:</span> <span class="s1">'inactive-list'</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">className</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span> <span class="nx">Comment</span> <span class="nx">One</span> <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>At this point you should have a good understanding on how to go about testing
your react components.  Remember to read through the amazing Enzyme
documentation to get some inspiration.</p>

<h2>Setting Up Karma</h2>

<p>Setting up Karma can be somewhat difficult.  I&#39;ll openly admit it was a pain for
me to get working.  Usually when I develop production React apps I use a
pre-built starter kit that has all the bells and whistles I know and love.
<a href="https://github.com/davezuko/react-redux-starter-kit">This is the production ready starter kit I highly recommend</a>. </p>

<p>The value in using Karma is fast test reloads, multiple browser testing, and
most importantly webpack preprocessing.  Once we get Karma set up we will be
able to run our tests through not just a <code>babel-loader</code> but ALSO our entire
webpack config.  This will provide a ton of convenience and make our testing
environment feel the same as our dev environment which is always a positive.</p>

<p>Lets get down to business...</p>
<pre class="highlight plaintext"><code>npm i karma karma-chai karma-mocha karma-webpack --save-dev
npm i karma-sourcemap-loader karma-phantomjs-launcher --save-dev
npm i karma-spec-reporter --save-dev
npm i phantomjs --save-dev

# The polyfills arn't required but will help with browser support issues
# and are easy enough to include in our karma config that I figured why not
npm i babel-polyfill phantomjs-polyfill --save-dev 
</code></pre>

<p>A lot of packages, I know.  Trust me getting this beast tuned in is SO worth it.</p>

<p>For our example we are going to be using <a href="http://phantomjs.org/">PhantomJS</a>.  No
real reason other than it&#39;s what I&#39;m used to using in the starter kit.  Feel
free to use a Chrome, Firefox, or Safari launcher instead or even on TOP of
PhantomJS (one of the cool things about Karma ;-)</p>

<p>Before going over the massive karma config install <code>yargs</code> to let you use
command line arguments to customize the Karma config a bit.
<code>
npm i yargs -S
</code></p>

<p>Now we will be able to pass in a flag to the Karma config to make it watch
our files for changes and re-run the suite on save SUPER fast.  Hooray productivity!</p>

<p><strong>Karma Config</strong>:
<code>
touch karma.config.js
</code></p>
<pre class="highlight javascript"><code><span class="c1">// ./karma.config.js</span>

<span class="kd">var</span> <span class="nx">argv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'yargs'</span><span class="p">).</span><span class="nx">argv</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span>
    <span class="c1">// only use PhantomJS for our 'test' browser</span>
    <span class="na">browsers</span><span class="p">:</span> <span class="p">[</span><span class="s1">'PhantomJS'</span><span class="p">],</span>

    <span class="c1">// just run once by default unless --watch flag is passed</span>
    <span class="na">singleRun</span><span class="p">:</span> <span class="o">!</span><span class="nx">argv</span><span class="p">.</span><span class="nx">watch</span><span class="p">,</span>      

    <span class="c1">// which karma frameworks do we want integrated</span>
    <span class="na">frameworks</span><span class="p">:</span> <span class="p">[</span><span class="s1">'mocha'</span><span class="p">,</span> <span class="s1">'chai'</span><span class="p">],</span>

    <span class="c1">// displays tests in a nice readable format</span>
    <span class="na">reporters</span><span class="p">:</span> <span class="p">[</span><span class="s1">'spec'</span><span class="p">],</span>

    <span class="c1">// include some polyfills for babel and phantomjs</span>
    <span class="na">files</span><span class="p">:</span> <span class="p">[</span>
      <span class="s1">'node_modules/babel-polyfill/dist/polyfill.js'</span><span class="p">,</span>
      <span class="s1">'./node_modules/phantomjs-polyfill/bind-polyfill.js'</span><span class="p">,</span>
      <span class="s1">'./test/**/*.js'</span> <span class="c1">// specify files to watch for tests</span>
    <span class="p">],</span>
    <span class="na">preprocessors</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// these files we want to be precompiled with webpack</span>
      <span class="c1">// also run tests throug sourcemap for easier debugging</span>
      <span class="p">[</span><span class="s1">'./test/**/*.js'</span><span class="p">]:</span> <span class="p">[</span><span class="s1">'webpack'</span><span class="p">,</span> <span class="s1">'sourcemap'</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="c1">// A lot of people will reuse the same webpack config that they use</span>
    <span class="c1">// in development for karma but remove any production plugins like UglifyJS etc.</span>
    <span class="c1">// I chose to just re-write the config so readers can see what it needs to have</span>
    <span class="na">webpack</span><span class="p">:</span> <span class="p">{</span>
       <span class="na">devtool</span><span class="p">:</span> <span class="s1">'inline-source-map'</span><span class="p">,</span>
       <span class="na">resolve</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// allow us to import components in tests like:</span>
        <span class="c1">// import Example from 'components/Example';</span>
        <span class="na">root</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'./src'</span><span class="p">),</span>

        <span class="c1">// allow us to avoid including extension name</span>
        <span class="na">extensions</span><span class="p">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'.js'</span><span class="p">,</span> <span class="s1">'.jsx'</span><span class="p">],</span>

        <span class="c1">// required for enzyme to work properly</span>
        <span class="na">alias</span><span class="p">:</span> <span class="p">{</span>
          <span class="s1">'sinon'</span><span class="p">:</span> <span class="s1">'sinon/pkg/sinon'</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// don't run babel-loader through the sinon module</span>
        <span class="na">noParse</span><span class="p">:</span> <span class="p">[</span>
          <span class="sr">/node_modules</span><span class="se">\/</span><span class="sr">sinon</span><span class="se">\/</span><span class="sr">/</span>
        <span class="p">],</span>
        <span class="c1">// run babel loader for our tests</span>
        <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span> <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">js</span><span class="se">?</span><span class="sr">$/</span><span class="p">,</span> <span class="na">exclude</span><span class="p">:</span> <span class="sr">/node_modules/</span><span class="p">,</span> <span class="na">loader</span><span class="p">:</span> <span class="s1">'babel'</span> <span class="p">},</span>
        <span class="p">],</span>
      <span class="p">},</span>
      <span class="c1">// required for enzyme to work properly</span>
      <span class="na">externals</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'jsdom'</span><span class="p">:</span> <span class="s1">'window'</span><span class="p">,</span>
        <span class="s1">'cheerio'</span><span class="p">:</span> <span class="s1">'window'</span><span class="p">,</span>
        <span class="s1">'react/lib/ExecutionEnvironment'</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s1">'react/lib/ReactContext'</span><span class="p">:</span> <span class="s1">'window'</span>
      <span class="p">},</span>
    <span class="p">},</span>
    <span class="na">webpackMiddleware</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">noInfo</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="c1">// tell karma all the plugins we're going to be using to prevent warnings</span>
    <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
      <span class="s1">'karma-mocha'</span><span class="p">,</span>
      <span class="s1">'karma-chai'</span><span class="p">,</span>
      <span class="s1">'karma-webpack'</span><span class="p">,</span>
      <span class="s1">'karma-phantomjs-launcher'</span><span class="p">,</span>
      <span class="s1">'karma-spec-reporter'</span><span class="p">,</span>
      <span class="s1">'karma-sourcemap-loader'</span>
    <span class="p">]</span>
  <span class="p">});</span>
<span class="p">};</span>
</code></pre>

<p>Read through all the comments once or twice to get a better idea of what this
config is doing.  One of the beautiful things about Webpack is because it&#39;s all
just normal JavaScript code we could &#39;refactor&#39; our config files.  In fact,
that&#39;s what most starter kits end up doing!  </p>

<p>With Karma set up the last thing we have to do is update our package.json with
new scripts to run the tests:</p>
<pre class="highlight javascript"><code><span class="err">#</span> <span class="kr">package</span><span class="p">.</span><span class="nx">json</span>
  <span class="s2">"scripts"</span> <span class="p">{</span>
    <span class="s2">"test"</span><span class="err">:</span> <span class="s2">"node_modules/.bin/karma start karma.config.js"</span><span class="p">,</span>
    <span class="s2">"test:dev"</span><span class="err">:</span> <span class="s2">"npm run test -- --watch"</span><span class="p">,</span>
    <span class="s2">"old_test"</span><span class="err">:</span> <span class="s2">"mocha --compilers js:babel-register --require ./test/test_helper.js --recursive"</span><span class="p">,</span>
    <span class="s2">"old_test:watch"</span><span class="err">:</span> <span class="s2">"npm test -- --watch"</span>
  <span class="p">}</span>
</code></pre>

<p>I renamed the old test scripts to have a prefix of &#39;old_&#39;.</p>

<p>The final <code>package.json</code> looks like this:</p>
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="s2">"name"</span><span class="err">:</span> <span class="s2">"react-testing-starter-kit"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="err">:</span> <span class="s2">"0.1.0"</span><span class="p">,</span>
  <span class="s2">"description"</span><span class="err">:</span> <span class="s2">"React starter kit with nice testing environment set up."</span><span class="p">,</span>
  <span class="s2">"main"</span><span class="err">:</span> <span class="s2">"src/main.js"</span><span class="p">,</span>
  <span class="s2">"directories"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"test"</span><span class="err">:</span> <span class="s2">"tests"</span><span class="p">,</span>
    <span class="s2">"src"</span><span class="err">:</span> <span class="s2">"src"</span><span class="p">,</span>
    <span class="s2">"dist"</span><span class="err">:</span> <span class="s2">"dist"</span>
  <span class="p">},</span>
  <span class="s2">"dependencies"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"react"</span><span class="err">:</span> <span class="s2">"^0.14.6"</span><span class="p">,</span>
    <span class="s2">"react-dom"</span><span class="err">:</span> <span class="s2">"^0.14.6"</span><span class="p">,</span>
    <span class="s2">"yargs"</span><span class="err">:</span> <span class="s2">"^3.31.0"</span>
  <span class="p">},</span>
  <span class="s2">"devDependencies"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"babel-core"</span><span class="err">:</span> <span class="s2">"^6.4.0"</span><span class="p">,</span>
    <span class="s2">"babel-loader"</span><span class="err">:</span> <span class="s2">"^6.2.1"</span><span class="p">,</span>
    <span class="s2">"babel-polyfill"</span><span class="err">:</span> <span class="s2">"^6.3.14"</span><span class="p">,</span>
    <span class="s2">"babel-preset-es2015"</span><span class="err">:</span> <span class="s2">"^6.3.13"</span><span class="p">,</span>
    <span class="s2">"babel-preset-react"</span><span class="err">:</span> <span class="s2">"^6.3.13"</span><span class="p">,</span>
    <span class="s2">"babel-register"</span><span class="err">:</span> <span class="s2">"^6.3.13"</span><span class="p">,</span>
    <span class="s2">"chai"</span><span class="err">:</span> <span class="s2">"^3.4.1"</span><span class="p">,</span>
    <span class="s2">"enzyme"</span><span class="err">:</span> <span class="s2">"^1.2.0"</span><span class="p">,</span>
    <span class="s2">"json-loader"</span><span class="err">:</span> <span class="s2">"^0.5.4"</span><span class="p">,</span>
    <span class="s2">"karma"</span><span class="err">:</span> <span class="s2">"^0.13.19"</span><span class="p">,</span>
    <span class="s2">"karma-chai"</span><span class="err">:</span> <span class="s2">"^0.1.0"</span><span class="p">,</span>
    <span class="s2">"karma-mocha"</span><span class="err">:</span> <span class="s2">"^0.2.1"</span><span class="p">,</span>
    <span class="s2">"karma-phantomjs-launcher"</span><span class="err">:</span> <span class="s2">"^0.2.3"</span><span class="p">,</span>
    <span class="s2">"karma-sourcemap-loader"</span><span class="err">:</span> <span class="s2">"^0.3.6"</span><span class="p">,</span>
    <span class="s2">"karma-spec-reporter"</span><span class="err">:</span> <span class="s2">"0.0.23"</span><span class="p">,</span>
    <span class="s2">"karma-webpack"</span><span class="err">:</span> <span class="s2">"^1.7.0"</span><span class="p">,</span>
    <span class="s2">"mocha"</span><span class="err">:</span> <span class="s2">"^2.3.4"</span><span class="p">,</span>
    <span class="s2">"phantomjs"</span><span class="err">:</span> <span class="s2">"^1.9.19"</span><span class="p">,</span>
    <span class="s2">"phantomjs-polyfill"</span><span class="err">:</span> <span class="s2">"0.0.1"</span><span class="p">,</span>
    <span class="s2">"react-addons-test-utils"</span><span class="err">:</span> <span class="s2">"^0.14.6"</span><span class="p">,</span>
    <span class="s2">"sinon"</span><span class="err">:</span> <span class="s2">"^1.17.2"</span><span class="p">,</span>
    <span class="s2">"webpack"</span><span class="err">:</span> <span class="s2">"^1.12.11"</span><span class="p">,</span>
    <span class="s2">"webpack-dev-server"</span><span class="err">:</span> <span class="s2">"^1.14.1"</span>
  <span class="p">},</span>
  <span class="s2">"scripts"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"test"</span><span class="err">:</span> <span class="s2">"node_modules/.bin/karma start karma.config.js"</span><span class="p">,</span>
    <span class="s2">"test:dev"</span><span class="err">:</span> <span class="s2">"npm run test -- --watch"</span><span class="p">,</span>
    <span class="s2">"build"</span><span class="err">:</span> <span class="s2">"webpack"</span><span class="p">,</span>
    <span class="s2">"dev"</span><span class="err">:</span> <span class="s2">"webpack-dev-server --port 3000 --devtool eval --progress --colors --hot --content-base dist"</span><span class="p">,</span>
    <span class="s2">"old_test"</span><span class="err">:</span> <span class="s2">"mocha --compilers js:babel-register --require ./test/test_helper.js --recursive"</span><span class="p">,</span>
    <span class="s2">"old_test:watch"</span><span class="err">:</span> <span class="s2">"npm test -- --watch"</span>
  <span class="p">},</span>
  <span class="s2">"repository"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"git"</span><span class="p">,</span>
    <span class="s2">"url"</span><span class="err">:</span> <span class="s2">"tbd"</span>
  <span class="p">},</span>
  <span class="s2">"author"</span><span class="err">:</span> <span class="s2">"Spencer Dixon"</span><span class="p">,</span>
  <span class="s2">"license"</span><span class="err">:</span> <span class="s2">"ISC"</span>
<span class="p">}</span>
</code></pre>

<p>With the addition of webpack preprocessing in our test suite we can now remove
those annoying relative path declarations inside our tests:</p>
<pre class="highlight javascript"><code><span class="c1">// test/containers/Root.spec.js</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">shallow</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'enzyme'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Root</span> <span class="nx">from</span> <span class="s1">'containers/Root'</span><span class="p">;</span>               <span class="c1">// new import statement</span>
<span class="c1">// import Root from '../../src/containers/Root';  // old import statement</span>

<span class="c1">// test/components/CommentList.spec.js</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">CommentList</span> <span class="nx">from</span> <span class="s1">'components/CommentList'</span><span class="p">;</span>               <span class="c1">// new import statement</span>
<span class="c1">// import CommentList from '../../src/components/CommentList';  // old import statement</span>

<span class="kr">import</span> <span class="p">{</span>
  <span class="nx">describeWithDOM</span><span class="p">,</span>
  <span class="nx">mount</span><span class="p">,</span>
  <span class="nx">shallow</span><span class="p">,</span>
  <span class="nx">spyLifecycle</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">'enzyme'</span><span class="p">;</span>

</code></pre>

<p>To use this starter kit in development now all you need to do is run:  </p>
<pre class="highlight javascript"><code><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">dev</span>         <span class="err">#</span> <span class="nx">note</span> <span class="nx">the</span> <span class="nx">addition</span> <span class="nx">of</span> <span class="nx">run</span>
<span class="nx">npm</span> <span class="nx">run</span> <span class="nx">test</span><span class="err">:</span><span class="nx">dev</span>    <span class="err">#</span> <span class="nx">note</span> <span class="nx">the</span> <span class="nx">addition</span> <span class="nx">of</span> <span class="nx">run</span>
</code></pre>

<p><a href="https://github.com/SpencerCDixon/react-testing-starter-kit">Make sure to check out the original source code on github if anything was unclear.</a></p>

<h3>Conclusion</h3>

<p>We have now set up a solid testing environment that can grow and evolve to your
projects specific needs.  In the next blog post I will spend more time going
over specific testing scenarios and how to test Redux, my preferred flux
implementation.  </p>

<p>I&#39;ve only been programming in React for a few months but I&#39;m already in love.  I
hope this tutorial has helped you to get a deeper understanding of some React
testing best practices.  Feel free to reach out to me with any
questions/comments.  Test on my friends!</p>


  <a href="#" id="hide_comments">Hide Comments<a>
    <div id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
                  var disqus_shortname = 'spencerdixon';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </article>
    </div>

    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51806130-1', 'auto');
  ga('send', 'pageview');
</script>
    <script src="../javascripts/all.js" type="text/javascript"></script>
  </body>
</html>
